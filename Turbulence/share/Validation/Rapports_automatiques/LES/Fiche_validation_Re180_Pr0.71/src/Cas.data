# PARALLEL OK #
Dimension 3
Pb_Thermohydraulique_Turbulent pb
Domaine dom

# BEGIN MESH #
Mailler dom
{
	Pave Cavite
	{
		Origine 0 _Y_BAS_ 0
		Nombre_de_Noeuds _Nx_ _Ny_ _Nz_
		Longueurs 6.4 _Ly_ 3.2
		Facteurs 1 1 1
	}
	{
		Bord PerioX	X = 0		_Y_BAS_ <= Y <= _Y_HAUT_	0 <= Z <= 3.2
		Bord PerioX	X = 6.4		_Y_BAS_ <= Y <= _Y_HAUT_	0 <= Z <= 3.2
		Bord PerioZ	Z = 0		0 <= X <= 6.4			_Y_BAS_ <= Y <= _Y_HAUT_
		Bord PerioZ	Z = 3.2		0 <= X <= 6.4			_Y_BAS_ <= Y <= _Y_HAUT_
		Bord Bas	Y = _Y_BAS_	0 <= X <= 6.4			0 <= Z <= 3.2
		Bord Haut	Y = _Y_HAUT_	0 <= X <= 6.4			0 <= Z <= 3.2
	}
}

_RAFFINEMENT_
Corriger_frontiere_periodique { domaine dom bord PerioX }
Corriger_frontiere_periodique { domaine dom bord PerioZ }
# END MESH #

# BEGIN PARTITION
Partition dom
{
        Partitionneur metis { Nb_parts 3 }
        Larg_joint 2
	periodique 2 PerioX PerioZ
        Nom_Zones DOM
}
End
END PARTITION #

# BEGIN SCATTER
Scatter DOM.Zones dom
END SCATTER #

_DIS_ dis

Runge_Kutta_ordre_3 sch_RK3
Read sch_RK3
{
	tinit 0
	tmax _T_FIN_
	dt_start dt_calc
	dt_min 1e-7
	dt_max 1
	dt_impr 5
	dt_sauv 500
	seuil_statio 1e-15
	facsec 1
	no_check_disk_space
	periode_sauvegarde_securite_en_heures 11
}

Fluide_incompressible air
Read air
{
	mu	champ_uniforme 1 2.84e-5
 	rho	champ_uniforme 1 0.011928
	lambda	champ_uniforme 1 0.20772
	Cp	champ_uniforme 1 5193
	beta_th	champ_uniforme 1 1.9954e-3
}

Champ_uniforme gravite
Read gravite 3 0 0 0

Associate air gravite
Associate pb dom
Associate pb sch_RK3
Associate pb air

Discretize pb dis

Read pb
{
	Navier_Stokes_turbulent
	{
		Solveur_pression	petsc Cholesky { }
		Convection		{ _CONV1_ }
		Diffusion		{ }
		Conditions_initiales	{ vitesse champ_init_canal_sinal 3 { Ucent 9.8945 h 1 ampli_sin 0 omega 1 ampli_bruit 0.5 } }
		boundary_conditions	{
					PerioX	periodique
					PerioZ	periodique
					Haut	_CLH_
					Bas	_CLH_
					}
		Modele_turbulence sous_maille_WALE
					{
					turbulence_paroi loi_standard_hydr
					dt_impr_ustar 20
					}
		Traitement_particulier	{
					canal	{
						dt_impr_moy_spat 200
						dt_impr_moy_temp 200
						debut_stat _T_DEB_
						}
					}
		Sources			{ canal_perio { bord PerioX } }
		Sources			{ source_Robin 2 Haut Bas # 0.005 # }
	}

	Convection_diffusion_temperature_turbulent
	{
		Convection		{ _CONV2_ }
		Diffusion		{ }
		Conditions_initiales	{ temperature champ_fonc_xyz dom 1 0 }
		boundary_conditions	{
					PerioX	periodique
					PerioZ	periodique
					Haut	_CLT_
					Bas	_CLT_
					}
		Modele_turbulence Prandtl
					{
					turbulence_paroi loi_standard_hydr_scalaire
					dt_impr_nusselt 20
					}
		Sources			{ puissance_thermique champ_uniforme 1 1 }
		Sources			{ source_Robin_scalaire 2 Haut _T1_ Bas _T0_ # 0.005 # }
	}

	Postraitement
	{
	Definition_champs		{
					moyenne_vitesse		Moyenne { t_deb _T_DEB_ t_fin _T_FIN_ source refChamp { Pb_champ pb vitesse } }
					moyenne_temperature	Moyenne { t_deb _T_DEB_ t_fin _T_FIN_ source refChamp { Pb_champ pb temperature } }
					ecart_type_vitesse	Ecart_type { t_deb _T_DEB_ t_fin _T_FIN_ source refChamp { Pb_champ pb vitesse } }
					ecart_type_temperature	Ecart_type { t_deb _T_DEB_ t_fin _T_FIN_ source refChamp { Pb_champ pb temperature } }
					min_temperature		Reduction_0D { methode min source refChamp { Pb_champ pb temperature } }
					max_temperature		Reduction_0D { methode max source refChamp { Pb_champ pb temperature } }
					}
		Sondes			{
					sonde_vitesse			_LOC_	vitesse			periode 0.5 points 1 3.2 1 1.6
					sonde_temperature		_LOC_	temperature		periode 0.5 points 1 3.2 1 1.6
					sonde_moyenne_vitesse		_LOC_	moyenne_vitesse		periode 0.5 points 1 3.2 1 1.6
					sonde_moyenne_temperature	_LOC_	moyenne_temperature	periode 0.5 points 1 3.2 1 1.6
					sonde_ecart_type_vitesse	_LOC_	ecart_type_vitesse	periode 0.5 points 1 3.2 1 1.6
					sonde_ecart_type_temperature	_LOC_	ecart_type_temperature	periode 0.5 points 1 3.2 1 1.6

					coupe_vitesse			_LOC_	vitesse			periode 5 segment _N_ _Ox_ _Oy1_ _Oz_	_Ox_ _Oy2_ _Oz_
					coupe_temperature		_LOC_	temperature		periode 5 segment _N_ _Ox_ _Oy1_ _Oz_	_Ox_ _Oy2_ _Oz_
					coupe_moyenne_vitesse		_LOC_	moyenne_vitesse		periode 5 segment _N_ _Ox_ _Oy1_ _Oz_	_Ox_ _Oy2_ _Oz_
					coupe_moyenne_temperature	_LOC_	moyenne_temperature	periode 5 segment _N_ _Ox_ _Oy1_ _Oz_	_Ox_ _Oy2_ _Oz_
					coupe_ecart_type_vitesse	_LOC_	ecart_type_vitesse	periode 5 segment _N_ _Ox_ _Oy1_ _Oz_	_Ox_ _Oy2_ _Oz_
					coupe_ecart_type_temperature	_LOC_	ecart_type_temperature	periode 5 segment _N_ _Ox_ _Oy1_ _Oz_	_Ox_ _Oy2_ _Oz_
					}
		Format lata_v2
		Champs dt_post 200	{
					vitesse som
					temperature som
					min_temperature som
					max_temperature som
					}
		Statistiques dt_post 200
					{
					t_deb _T_DEB_ t_fin _T_FIN_
					moyenne vitesse
					moyenne temperature
					ecart_type vitesse
					ecart_type temperature
					}
	}
	sauvegarde formatte pb.sauv
}

Solve pb
End
